(()=>{"use strict";const e=window.wp.components,a=window.wp.element,t=window.wp.i18n,s=window.ReactJSXRuntime,o=window.MockomaticSettings||{},i=o.restUrl||"",c=o.nonce||"",n=o.defaults||{},m=o.textModels||{},l=o.imageModels||{},r=i.replace(/\/$/,""),d=o.adminEditBase||"",h=(o.siteUrl||"").replace(/\/$/,""),g={posts:Number.isFinite(n.posts)?n.posts:5,pages:Number.isFinite(n.pages)?n.pages:2,categories:"boolean"!=typeof n.categories||n.categories,tags:"boolean"!=typeof n.tags||n.tags,generateImages:!!n.images,instructions:n.instructions||"",textModel:n.textModel||Object.keys(m)[0]||"",imageModel:n.imageModel||Object.keys(l)[0]||""},p=(e,a)=>window.fetch(`${r}${e}`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":c},body:JSON.stringify(a)}).then(e=>e.ok?e.json():e.json().catch(()=>{throw new Error(`HTTP ${e.status}`)}).then(a=>{const t=a&&a.message?a.message:`HTTP ${e.status}`;throw new Error(t)})),_=()=>{const[o,c]=(0,a.useState)(g),[n,r]=(0,a.useState)([]),[_,k]=(0,a.useState)({value:0,label:""}),[x,u]=(0,a.useState)(!1),[j,N]=(0,a.useState)(!1),[b,f]=(0,a.useState)(!1),[v,y]=(0,a.useState)(""),[C,w]=(0,a.useState)([]),[I,$]=(0,a.useState)(!1),M=(0,a.useRef)(!1),P=(0,a.useMemo)(()=>Object.entries(m).map(([e,a])=>({value:e,label:a})),[m]),S=(0,a.useMemo)(()=>Object.entries(l).map(([e,a])=>({value:e,label:a})),[l]),T=(0,a.useMemo)(()=>[{value:"off",label:(0,t.__)("Off","mockomatic")},...S],[S]),F=(e,a=!1)=>{r(t=>[...t,{text:e,isError:a}])},E=(e,a)=>{const t=parseInt(a,10);c(a=>({...a,[e]:Number.isNaN(t)?0:t}))},G=(e,a)=>{c(t=>({...t,[e]:a}))},R=(e,a,t="",s={})=>{w(o=>o.map((o,i)=>i===e?{...o,status:a,note:t,...s}:o))},B=()=>{x&&!j&&(N(!0),M.current=!0,F((0,t.__)("Pausing after the current item…","mockomatic")),k(e=>({...e,label:(0,t.__)("Pausing…","mockomatic")})))},O=()=>{x&&j&&(N(!1),M.current=!1,F((0,t.__)("Resuming…","mockomatic")),k(e=>({...e,label:(0,t.__)("Resuming…","mockomatic")})))},L=async()=>{if(M.current)for(F((0,t.__)("Paused. Click “Resume” to continue.","mockomatic")),k(e=>({...e,label:(0,t.__)("Paused","mockomatic")}));M.current;)await new Promise(e=>setTimeout(e,300))},V=async e=>{if(e.preventDefault(),r([]),y(""),k({value:0,label:""}),w([]),N(!1),M.current=!1,f(!1),$(!0),o.posts<=0&&o.pages<=0)y((0,t.__)("Please request at least one post or page.","mockomatic"));else{u(!0);try{F((0,t.__)("Requesting titles from AI…","mockomatic")),k({value:3,label:(0,t.__)("Requesting titles…","mockomatic")});const e=await p("/titles",{posts:o.posts,pages:o.pages,instructions:o.instructions,model:o.textModel,generate_images:!!o.generateImages}),a=e.posts||[],s=e.pages||[],i=[...a.map(e=>({type:"post",title:e.title,categories:e.categories||[],tags:e.tags||[],illustration_description:o.generateImages&&e.illustration_description||""})),...s.map(e=>({type:"page",title:e.title}))];if(!i.length)throw new Error((0,t.__)("No titles returned by AI.","mockomatic"));w(i.map(e=>({...e,status:"pending",note:""}))),F((0,t.__)("Titles ready. Generating content now…","mockomatic")),k({value:8,label:(0,t.__)("Generating content…","mockomatic")});for(let e=0;e<i.length;e+=1){await L();const a=i[e],s="post"===a.type?(0,t.__)("Generating post","mockomatic"):(0,t.__)("Generating page","mockomatic");F(`${s}: ${a.title}`),R(e,"in-progress");const c={title:a.title,post_type:a.type,instructions:o.instructions,model:o.textModel,generate_image:!!o.generateImages,image_model:o.imageModel,categories:"post"===a.type&&o.categories?a.categories:[],tags:"post"===a.type&&o.tags?a.tags:[],illustration_description:"post"===a.type&&o.generateImages?a.illustration_description:""};try{const s=await p("/post",c);s.attachment_id&&F(/* translators: %s is the title of the item that received a featured image. */ /* translators: %s is the title of the item that received a featured image. */
(0,t.sprintf)((0,t.__)("Featured image set for %s","mockomatic"),s.title||a.title)),s.image_error&&F(`${(0,t.__)("Image error for","mockomatic")} ${s.title||a.title}: ${s.image_error}`,!0),R(e,"done","",{post_id:s.post_id,post_type:s.post_type})}catch(a){F(`${(0,t.__)("Error:","mockomatic")} ${a.message}`,!0),R(e,"error",a.message)}const n=8+Math.round((e+1)/i.length*82);k({value:n,label:`${s} (${e+1}/${i.length})`})}k({value:100,label:(0,t.__)("Generation completed.","mockomatic")}),F((0,t.__)("Generation completed.","mockomatic"))}catch(e){y(e.message||(0,t.__)("Something went wrong.","mockomatic")),k({value:100,label:(0,t.__)("Error","mockomatic")}),F(`${(0,t.__)("Error:","mockomatic")} ${e.message}`,!0)}finally{u(!1),N(!1)}}};return i?(0,s.jsxs)("div",{className:"mockomatic-app",children:[!I&&(0,s.jsx)(e.Card,{className:"mockomatic-hero-card",children:(0,s.jsxs)(e.CardBody,{children:[(0,s.jsxs)("div",{className:"mockomatic-hero",children:[(0,s.jsx)("div",{className:"mockomatic-hero-heading",children:(0,s.jsx)("h2",{className:"mockomatic-hero-title",children:(0,t.__)("Generate Demo Content","mockomatic")})}),(0,s.jsxs)("div",{className:"mockomatic-cta",children:[(0,s.jsx)("button",{type:"button",className:"button button-primary button-hero mockomatic-hero-button",onClick:V,disabled:x,children:x?(0,t.__)("Working…","mockomatic"):(0,t.__)("Start Generating","mockomatic")}),x&&(0,s.jsx)(e.Button,{variant:"secondary",onClick:j?O:B,disabled:!x,className:"mockomatic-stop-button",children:j?(0,t.__)("Resume","mockomatic"):(0,t.__)("Pause","mockomatic")})]}),(0,s.jsxs)("div",{className:"mockomatic-hero-grid","aria-live":"polite",children:[(0,s.jsxs)("div",{className:"mockomatic-hero-field",children:[(0,s.jsxs)("div",{className:"mockomatic-hero-field-title",children:[(0,s.jsx)("span",{className:"dashicons dashicons-admin-post","aria-hidden":"true"}),(0,s.jsx)("span",{children:(0,t.__)("Posts","mockomatic")})]}),(0,s.jsx)(e.TextControl,{label:(0,t.__)("Posts","mockomatic"),type:"number",min:0,value:o.posts,onChange:e=>E("posts",e),hideLabelFromVision:!0,help:(0,t.__)("Number of posts","mockomatic")})]}),(0,s.jsxs)("div",{className:"mockomatic-hero-field",children:[(0,s.jsxs)("div",{className:"mockomatic-hero-field-title",children:[(0,s.jsx)("span",{className:"dashicons dashicons-admin-page","aria-hidden":"true"}),(0,s.jsx)("span",{children:(0,t.__)("Pages","mockomatic")})]}),(0,s.jsx)(e.TextControl,{label:(0,t.__)("Pages","mockomatic"),type:"number",min:0,value:o.pages,onChange:e=>E("pages",e),hideLabelFromVision:!0,help:(0,t.__)("Number of pages","mockomatic")})]}),(0,s.jsxs)("div",{className:"mockomatic-hero-field",children:[(0,s.jsxs)("div",{className:"mockomatic-hero-field-title",children:[(0,s.jsx)("span",{className:"dashicons dashicons-editor-textcolor","aria-hidden":"true"}),(0,s.jsx)("span",{children:(0,t.__)("Text Generation","mockomatic")})]}),(0,s.jsx)(e.SelectControl,{label:(0,t.__)("Text model","mockomatic"),value:o.textModel,options:P,onChange:e=>G("textModel",e),hideLabelFromVision:!0,help:(0,t.__)("Model","mockomatic")})]}),(0,s.jsxs)("div",{className:"mockomatic-hero-field",children:[(0,s.jsxs)("div",{className:"mockomatic-hero-field-title",children:[(0,s.jsx)("span",{className:"dashicons dashicons-format-image","aria-hidden":"true"}),(0,s.jsx)("span",{children:(0,t.__)("Image Generation","mockomatic")})]}),(0,s.jsx)(e.SelectControl,{label:(0,t.__)("Images","mockomatic"),value:o.generateImages?o.imageModel:"off",onChange:e=>{c("off"!==e?a=>({...a,imageModel:e,generateImages:!0}):e=>({...e,generateImages:!1}))},options:T,hideLabelFromVision:!0,help:(0,t.__)("Select a model or disable images","mockomatic")})]})]}),(0,s.jsx)(e.Button,{variant:"link",className:"mockomatic-advanced-toggle",onClick:()=>f(e=>!e),"aria-expanded":b,children:b?(0,t.__)("Hide advanced options ▲","mockomatic"):(0,t.__)("Show advanced options ▼","mockomatic")})]}),v&&(0,s.jsx)(e.Notice,{status:"error",onRemove:()=>y(""),children:v})]})}),b&&!I&&(0,s.jsx)(e.Card,{className:"mockomatic-form-card",children:(0,s.jsx)(e.CardBody,{children:(0,s.jsxs)("form",{onSubmit:V,children:[(0,s.jsxs)(e.Panel,{children:[(0,s.jsxs)(e.PanelBody,{title:(0,s.jsxs)("span",{className:"mockomatic-panel-title",children:[(0,s.jsx)("span",{className:"dashicons dashicons-admin-post","aria-hidden":"true"}),(0,t.__)("What to generate","mockomatic")]}),initialOpen:!0,children:[(0,s.jsxs)(e.Flex,{wrap:!0,children:[(0,s.jsx)(e.FlexItem,{className:"mockomatic-flex-field",children:(0,s.jsx)(e.TextControl,{label:(0,t.__)("Generate posts","mockomatic"),type:"number",min:0,value:o.posts,onChange:e=>E("posts",e)})}),(0,s.jsx)(e.FlexItem,{className:"mockomatic-flex-field",children:(0,s.jsx)(e.TextControl,{label:(0,t.__)("Generate pages","mockomatic"),type:"number",min:0,value:o.pages,onChange:e=>E("pages",e)})})]}),(0,s.jsxs)(e.Flex,{wrap:!0,style:{marginTop:"16px"},children:[(0,s.jsx)(e.FlexItem,{className:"mockomatic-flex-field",children:(0,s.jsx)(e.ToggleControl,{label:(0,t.__)("Create categories","mockomatic"),checked:o.categories,onChange:e=>G("categories",e)})}),(0,s.jsx)(e.FlexItem,{className:"mockomatic-flex-field",children:(0,s.jsx)(e.ToggleControl,{label:(0,t.__)("Create tags","mockomatic"),checked:o.tags,onChange:e=>G("tags",e)})}),(0,s.jsx)(e.FlexItem,{className:"mockomatic-flex-field",children:(0,s.jsx)(e.ToggleControl,{label:(0,t.__)("Generate featured images (Replicate)","mockomatic"),checked:o.generateImages,onChange:e=>G("generateImages",e)})})]})]}),(0,s.jsx)(e.PanelBody,{title:(0,s.jsxs)("span",{className:"mockomatic-panel-title",children:[(0,s.jsx)("span",{className:"dashicons dashicons-admin-settings","aria-hidden":"true"}),(0,t.__)("Models","mockomatic")]}),initialOpen:!0,children:(0,s.jsxs)(e.Flex,{wrap:!0,children:[(0,s.jsx)(e.FlexItem,{className:"mockomatic-flex-field",children:(0,s.jsx)(e.SelectControl,{label:(0,t.__)("Text model","mockomatic"),value:o.textModel,options:P,onChange:e=>G("textModel",e)})}),(0,s.jsx)(e.FlexItem,{className:"mockomatic-flex-field",children:(0,s.jsx)(e.SelectControl,{label:(0,t.__)("Image model (Replicate)","mockomatic"),value:o.imageModel,options:S,onChange:e=>G("imageModel",e),help:(0,t.__)("Used only when featured images are enabled.","mockomatic"),disabled:!o.generateImages})})]})}),(0,s.jsx)(e.PanelBody,{title:(0,s.jsxs)("span",{className:"mockomatic-panel-title",children:[(0,s.jsx)("span",{className:"dashicons dashicons-format-status","aria-hidden":"true"}),(0,t.__)("Custom prompt","mockomatic")]}),initialOpen:!1,children:(0,s.jsx)(e.TextareaControl,{label:(0,t.__)("Optional instructions","mockomatic"),value:o.instructions,onChange:e=>G("instructions",e),rows:5,placeholder:(0,t.__)("e.g. Tech blog in English, playful tone, posts around 1200 words, pages shorter and more formal…","mockomatic")})})]}),(0,s.jsxs)("div",{className:"mockomatic-form-actions",children:[(0,s.jsx)(e.Button,{type:"submit",variant:"primary",disabled:x,children:x?(0,t.__)("Working…","mockomatic"):(0,t.__)("Start generating","mockomatic")}),(0,s.jsx)(e.Button,{variant:"tertiary",onClick:()=>f(!1),disabled:x,className:"mockomatic-cancel-button",children:(0,t.__)("Close advanced options","mockomatic")})]})]})})}),(I||x)&&(0,s.jsx)(e.Card,{className:"mockomatic-log-card",children:(0,s.jsxs)(e.CardBody,{children:[(0,s.jsxs)("div",{className:"mockomatic-log-heading",children:[(0,s.jsxs)("div",{className:"mockomatic-heading-with-icon",children:[(0,s.jsx)("span",{className:"dashicons dashicons-clock","aria-hidden":"true"}),(0,s.jsx)("strong",{children:(0,t.__)("Generation status","mockomatic")})]}),x&&(0,s.jsx)(e.Button,{variant:"secondary",onClick:j?O:B,disabled:!x,className:"mockomatic-stop-button",size:"small",children:j?(0,t.__)("Resume","mockomatic"):(0,t.__)("Pause","mockomatic")})]}),(0,s.jsx)("div",{className:"mockomatic-progress-box",children:(0,s.jsxs)("progress",{value:_.value,max:"100","aria-valuemin":"0","aria-valuemax":"100",children:[_.value,"%"]})}),(0,s.jsxs)("ul",{className:"mockomatic-log","aria-live":"polite",children:[n.map((e,a)=>(0,s.jsx)("li",{className:e.isError?"mockomatic-log-error":"",children:e.text},`${e.text}-${a}`)),!n.length&&(0,s.jsx)("li",{className:"mockomatic-log-empty",children:(0,t.__)("No messages yet. Click “Start generating” to begin.","mockomatic")})]}),C.length>0&&(0,s.jsxs)("div",{className:"mockomatic-task-list","aria-live":"polite",children:[(0,s.jsxs)("div",{className:"mockomatic-task-list-title",children:[(0,s.jsx)("span",{className:"dashicons dashicons-list-view","aria-hidden":"true"}),(0,t.__)("Queued items","mockomatic")]}),(0,s.jsx)("ul",{children:C.map((e,a)=>{const i=h&&e.post_id?`${h}/?${"page"===e.type?"page_id":"p"}=${e.post_id}`:"";return(0,s.jsxs)("li",{className:`status-${e.status}`,children:[(0,s.jsx)("span",{className:"mockomatic-task-status","aria-hidden":"true"}),(0,s.jsxs)("div",{className:"mockomatic-task-text",children:[(0,s.jsxs)("div",{className:"mockomatic-task-title",children:[(0,s.jsx)("strong",{children:e.title}),e.post_id&&d&&(0,s.jsxs)("a",{href:`${d}?post=${e.post_id}&action=edit`,className:"mockomatic-task-link",target:"_blank",rel:"noreferrer",children:[(0,s.jsx)("span",{className:"dashicons dashicons-edit","aria-hidden":"true"}),"page"===e.type?(0,t.__)("Edit Page","mockomatic"):(0,t.__)("Edit Post","mockomatic")]}),i&&(0,s.jsxs)("a",{href:i,className:"mockomatic-task-link",target:"_blank",rel:"noreferrer",children:[(0,s.jsx)("span",{className:"dashicons dashicons-visibility","aria-hidden":"true"}),"page"===e.type?(0,t.__)("View Page","mockomatic"):(0,t.__)("View Post","mockomatic")]})]}),(0,s.jsx)("span",{className:"mockomatic-task-meta",children:"post"===e.type?(0,t.__)("Post","mockomatic"):(0,t.__)("Page","mockomatic")}),"post"===e.type&&(0,s.jsxs)("span",{className:"mockomatic-task-meta mockomatic-task-taxonomies",children:[e.categories?.length>0&&(0,s.jsxs)("span",{className:"mockomatic-task-taxonomy",children:[(0,s.jsx)("span",{className:"dashicons dashicons-category","aria-hidden":"true"}),e.categories.join(", ")]}),e.tags?.length>0&&(0,s.jsxs)("span",{className:"mockomatic-task-taxonomy",children:[(0,s.jsx)("span",{className:"dashicons dashicons-tag","aria-hidden":"true"}),e.tags.join(", ")]}),!e.categories?.length&&!e.tags?.length&&(0,s.jsx)("span",{className:"mockomatic-task-taxonomy",children:(0,t.__)("No categories or tags","mockomatic")})]}),o.generateImages&&e.illustration_description&&(0,s.jsxs)("span",{className:"mockomatic-task-meta mockomatic-task-prompt",children:[(0,t.__)("Illustration prompt:","mockomatic")," ",e.illustration_description]}),e.note&&(0,s.jsx)("span",{className:"mockomatic-task-note",children:e.note})]})]},`${e.title}-${a}`)})})]})]})})]}):(0,s.jsx)(e.Notice,{status:"error",isDismissible:!1,children:(0,t.__)("Mockomatic REST endpoint unavailable.","mockomatic")})};document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("mockomatic-generate-root");e&&(0,a.render)((0,s.jsx)(_,{}),e)})})();